<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LedWall</Title>

    <script type="text/javascript" src="./jquery.js"> </script>
    <script type="text/javascript" src="./jquery183.js"> </script>
    <script type="text/javascript" src="./jquery191.js"> </script>

    <style>
      .slabImage{width:100px; height:100px; border:1px solid #aaaaaa; background-color :#909090 ;}
      .verticalContainer .horizontalContainer .miniContainer{width:100px;height:100px;padding:0px;border:1px solid #aaaaaa;}
      .slabs{display:flex;}
      .verticalContainer .horizontalContainer{display:flex;}
      .slabs .slabImage{text-align: center; line-height: 75px;}
      body{background-color: #64B5F6;}
      .formText{font-size: 20px; font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif; margin-left: 20px;}

      .slabsBigForm{border: 2px inset #aaaaaa;border-radius: 8px;background-color: #E3F2FD; height: 30px;width : 100px; text-align: center; font-size: 20px;}
      #bigForm{border : 3px solid #000000; border-radius: 10px; width : 500px;}
      #slabsNumber{border: 2px inset #aaaaaa;border-radius: 8px;background-color: #E3F2FD; height: 30px;width : 100px; text-align: center; font-size: 20px; margin-left: 120px;}
      #height{border: 2px inset #aaaaaa;border-radius: 8px;background-color: #E3F2FD; height: 30px;width : 100px; text-align: center; font-size: 20px; margin-left: 15px;}
      #width{border: 2px inset #aaaaaa;border-radius: 8px;background-color: #E3F2FD; height: 30px;width : 100px; text-align: center; font-size: 20px; margin-left: 18px;}
      #submitButton{width:100px;height:40px; border-radius: 5px; background-color:#E3F2FD; }
      #ledwallImage{height:100px;width:1980px;margin-left: -10px;margin-top: -10px;}
    </style>

  </head>

  <body>

    <header>
      <img src='ledwall.png' id="ledwallImage" alt="ledwall image">
    </header>

    <button type="button" id="loadFromJSON">Load From JSON</button>

    <ul id="menu-deroulant">
	<li> <p> Configurations pré-enregistrées </p>
		<ul>
      <div id="configs">
			<li>No config</li>
    </div>
		</ul>
	</li>

</ul>

    <form method="post" action = "acceuil.html">

        <div id="bigForm">
          <p> <label class="formText" for="nom">Number of slabs</label> : <input type="number" name="quantite" class="slabsBigForm" id="slabsNumber" max ="22" min="0" required /> </p>

          <p> <label class="formText" for="nom">Maximum width of the wall</label> : <input type="number" name="width" class="slabsBigForm" id="width" max ="22" min="1" required /> </p>

	         <p> <label class="formText" for="nom">Maximum height of the wall</label> : <input type="number" name="height" class="slabsBigForm" id="height" max ="22" min="1" required /> </p>
        </div>

      <div class = "slabsForm" id="slabsForm"> </div>

      <input type="submit" id="submitButton" value="Submit !" />

      </form>

<div id="verticalContainer" name="verticalContainer" class="verticalContainer">
    <div name="horizontalContainer" class="horizontalContainer" id="horizontalContainer1">
        <div name="miniContainer" class="miniContainer ui-droppable" id="conteneur1.1">
            <div id="slabImage1" class="slabImage ui-draggable" style="position: relative; left: -1px; top: -1px;"><p>
                1 </p></div>
        </div>
        <div name="miniContainer" class="miniContainer ui-droppable" id="conteneur1.2">
            <div id="slabImage2" class="slabImage ui-draggable" style="position: relative; left: -1px; top: -1px;"><p>
                2 </p></div>
        </div>
    </div>
    <div name="horizontalContainer" class="horizontalContainer" id="horizontalContainer2">
        <div name="miniContainer" class="miniContainer ui-droppable" id="conteneur2.1"></div>
        <div name="miniContainer" class="miniContainer ui-droppable" id="conteneur2.2"></div>
    </div>
</div>
    <button type="button" id="buildSlabs">Build Slabs</button>


    <script>

      $(function(){

          var numberOfSlabsForm = $("#slabsNumber");
 		      var slabsDiv = $("#slabs");

 		      /*numberOfSlabsForm.change(function(){
 			        var newNumberOfSlabs = numberOfSlabsForm.val();
 			        slabsDiv.empty();
 			        for (var i = 0 ; i< newNumberOfSlabs ; i++)
                {
 				             slabsDiv.append('<div id="slabImage'+(i+1)+'" class="slabImage" > <p> '+(i+1)+' </p> </div>');
 			          }
              $('.slabImage').draggable({snap:'.miniContainer'});
 			    });*/


 		       var widthForm = $("#width");
 	         var heightForm = $("#height");

 		       var horizontalContainer = $('.horizontalContainer');
 		       var verticalContainer = $('.verticalContainer');

           $("form :input").change(function(){
 			         var widthNewValue = widthForm.val();
 			         var heightNewValue = heightForm.val();
               var totalOfSlabs = numberOfSlabsForm.val();
               var slabsUnassigned = numberOfSlabsForm.val();
 			         verticalContainer.empty();
 			         for(var i = 0; i < heightNewValue; i++)
       		         {
       			           verticalContainer.append('<div name="horizontalContainer" class="horizontalContainer" id ="horizontalContainer'+(i+1)+'">');
       			           for(var j = 0; j < widthNewValue; j++)
       			             {
       				                horizontalContainerMini = $('#horizontalContainer'+(i+1));
                              var miniContainerAdded =$('<div name="miniContainer" class="miniContainer" id="conteneur'+(i+1)+'.'+(j+1)+'"></div>');
         		                  horizontalContainerMini.append(miniContainerAdded);
                              if (slabsUnassigned>0)
                                {
                                  miniContainerAdded.append('<div id="slabImage'+Math.abs(slabsUnassigned-totalOfSlabs-1)+'" class="slabImage" > <p> '+Math.abs(slabsUnassigned-totalOfSlabs-1)+' </p> </div>');
                                  slabsUnassigned = slabsUnassigned-1;
                                  $("#slabx"+(Math.abs(slabsUnassigned-totalOfSlabs+1))).val(j*18);
                                  $("#slaby"+(Math.abs(slabsUnassigned-totalOfSlabs+1))).val(i*18);
                                }
 				                 }
 				               verticalContainer.append('</div>');
       		         }

                   $(".miniContainer").droppable({ drop:function(event, ui){
                   $("#slabx"+(ui.draggable.attr("id").split('Image')[1]-1)).val((($(this).attr("id").split('.')[0].split('r')[1])-1)*18);
                   $("#slaby"+(ui.draggable.attr("id").split('Image')[1]-1)).val((($(this).attr("id").split('.')[1])-1)*18);
                    }});
                   $('.slabImage').draggable({snap:'.miniContainer'});
         		 });


     	       var slabsNumber = $('#slabsNumber');
       	     var slabs = $('#slabsForm');
       	     $('#slabsNumber').change(function(){
               slabsNumberChanged();
             });

             function slabsNumberChanged()
       	        {
       		         var slabsx = document.getElementsByClassName('slabx');
       		         var slabsy = document.getElementsByClassName('slaby');
       		         var slabs = document.getElementById('slabsForm');
       		         var newValue = document.getElementById('slabsNumber').value;
       		         if(newValue > slabsx.length)
       		             {
       			               for(var i = slabsx.length; i < newValue; i++)
       			                 {
         		                      slabsForm.innerHTML += '<p><label>Dalle '+(i+1)+'</label> x : <input type="number" class="slabx" name="slabx'+i+'" id="slabx'+i+'" min="0" required />  y : <input type="number" class="slaby" name="slaby'+i+'" id="slaby'+i+'" min="0" required /> </p>';
 			                       }
       		              }
       		         else
       		             {
       			               slabsForm.innerHTML = '';
       			               for(var i = 0 ; i < newValue; i++)
       			                 {
       				                    var x = document.getElementById('slabx'+i);
         			                    var y = document.getElementById('slaby'+i);
         			                    slabsForm.innerHTML += '<p><label>Dalle '+(i+1)+'</label> x : <input type="number" class="slabx" name="slabx'+i+'" id="slabx'+i+'" min="0" value="'+x+'" required />  y : <input type="number" class="slaby" name="slaby'+i+'" id="slaby'+i+'" min="0" value="'+y+'" required /> </p>';
 			                       }
         	             }
                };

                var buildSlabsButton = $('#buildSlabs');
                buildSlabsButton.click(function(){
                  var widthNewValue = widthForm.val();
    			        var heightNewValue = heightForm.val();
                  var totalOfSlabs = numberOfSlabsForm.val();
    			        verticalContainer.empty();
    			        for(var i = 0; i < heightNewValue; i++)
          		         {
          			           verticalContainer.append('<div name="horizontalContainer" class="horizontalContainer" id ="horizontalContainer'+(i+1)+'">');
          			           for(var j = 0; j < widthNewValue; j++)
          			             {
          				               horizontalContainerMini = $('#horizontalContainer'+(i+1));
                                 var miniContainerAdded =$('<div name="miniContainer" class="miniContainer" id="conteneur'+(i+1)+'.'+(j+1)+'"></div>');
            		                 horizontalContainerMini.append(miniContainerAdded);
                                  for (var slabId = 0; slabId<totalOfSlabs; slabId++){
                                    var x = $('#slabx'+slabId).val();
                                    var y = $('#slaby'+slabId).val();
                                    if (j*18<=x && x<(j+1)*18 && i*18<=y && y<(i+1)*18)
                                    {
                                      miniContainerAdded.append('<div id="slabImage'+(slabId+1)+'" class="slabImage" > <p> '+(slabId+1)+' </p> </div>');
                                    }
                                  }
    				                 }
    				               verticalContainer.append('</div>');
          		         }
                });

                var loadFromJSONButton = $('#loadFromJSON');
                loadFromJSONButton.click(function(){
                  var xmlhttp;
                  if (window.XMLHttpRequest) {
                    xmlhttp = new XMLHttpRequest();
                  } else {
                    // code for older browsers
                  xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
                 }
                  xmlhttp.onreadystatechange = function() {
                    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                    doc = eval('('+xmlhttp.responseText+')');
                    numberOfSlabsForm.val(parseInt(doc.meta.total));
                    widthForm.val(parseInt(doc.meta.width));
                    heightForm.val(parseInt(doc.meta.height));
                    slabsNumberChanged();
                    for (var i=0; i<doc.config.length; i++)
                    {
                        var slabx = document.getElementById("slabx"+i);
                        var slaby = document.getElementById("slaby"+i);
                        slabx.value = parseInt(doc.config[i].x);
                        slaby.value = parseInt(doc.config[i].y);
                    }
                  }
                };
                xmlhttp.open("GET", "hello.txt", true);
                xmlhttp.send();
              });

                })

    </script>

  </body>
</html>
